!function(){var n=["nfl","nba","nhl","ncaab","mlb","ncaaf"],t=["aa","mi"],e=new Date;function o(){var n,t,e=new Date,o=i("obj-affinity"),a=i("obj-aida");"complete"!==document.readyState?document.addEventListener("DOMContentLoaded",(function(i){n=null===o?new c("affinity",e,e,"001"):JSON.parse(o),t=null===a?new c("aida",e,e,"001"):JSON.parse(a),l(n),s(t)})):(l(n),s(t))}function i(n){return window.localStorage.getItem(n)}function a(n,t){var e,i;t||o(),e=n,i=JSON.stringify(t),window.localStorage.setItem(e,i);var a={conv:t.conv};window.dataLayer=window.dataLayer||[],window.dataLayer.push(a)}function s(n){var o=n.conv_init_date?new Date(n.conv_init_date):e,i=n.conv_last_visit?new Date(n.conv_last_visit):o,s=n.conv?n.conv:"001";i.toString()!==e.toString()&&((e-o)/31536e6>=1&&(s="00"+(parseInt(n.conv)+1).toString(),n=new c("aida",e,e,s)));return n&&(n=function(n){for(var e=3,o=1,i=t.length,s=0;s<i;s++){var l="aida-"+t[s],c=n.aida[l],r=new Date,_=!1,v=new Date(c.log[c.log.length-1]),g=(r-v)/864e5;if(0===c.count)++c.count,c.log.push(r),_=!0;else switch(t[s]){case"mi":g>o&&c.count<e&&(++c.count,c.log.push(r),_=!0);break;default:g>o&&c.count<1&&(++c.count,c.log.push(r),_=!0)}v!==c.conv_last_visit&&(n.conv_last_visit=new Date,n.conv_visit_log.push(new Date)),_&&a("obj-aida",n)}}(n)),n}function l(t){var o=t.conv_init_date?new Date(t.conv_init_date):e,s=t.conv_last_visit?new Date(t.conv_last_visit):o,l=t.conv?t.conv:"001";s.toString()!==e.toString()&&((e-o)/31536e6>=1&&(l="00"+(parseInt(t.conv)+1).toString(),t=new c("affinity",e,e,l)));var r=function(){var n=document.querySelector("body[class*='section-']");if(null!=n){var t=n.getAttribute("class");return t.substring(t.lastIndexOf("section-"))}}();if(r){if(r=r.lastIndexOf(" ")>0?r.substring(0,r.lastIndexOf(" ")).replace("section-",""):r.substring(r.lastIndexOf(" ")).replace("section-",""),!t){var _=i("obj-affinity");t=_?JSON.parse(_):new c("affinity",e,e,l)}if(n.includes(r)){var v="affinity-"+r,g=t.affinity[v],f=new Date;if(0===g.count)++g.count,g.log.push(f);else(f-new Date(g.log[g.log.length-1]))/864e5>1&&g.count<5&&(++g.count,g.log.push(f));s!==t.conv_last_visit&&(t.conv_last_visit=new Date,t.conv_visit_log.push(new Date)),a("obj-affinity",t)}}return r}function c(e,o,i,a){var s,l,c;switch(this.conv_init_date=o,this.conv_last_visit=i,this.conv=a,this.conv_visit_log=[],e){case"affinity":for(this.affinity={},s=n.length,l=0;l<s;l++)c="affinity-"+n[l],this.affinity[c]={count:0,log:[]};break;default:for(this.aida={},s=t.length,l=0;l<s;l++)c="aida-"+t[l],this.aida[c]={count:0,log:[]}}}o()}();var affiliate_list=[];function gtmds_init(){var n,t,e=null,o=new Date,i=get_local_storge_var("obj-conv"),a=get_local_storge_var("obj-tnn"),s=check_querystring(),l=get_local_storge_var("obj-screen-size"),c=screen.width+"x"+screen.height,r=navigator.platform;if(a&&"undefined"!==a){var _=JSON.parse(a);for(var v in e=new ObjTnn(_.tnn_init_date,_.tnn_last_visit,_.tnn_conv),_.tnn_sport_log)e.tnn_sport_log[v]=_.tnn_sport_log[v];if(null!==s){var g=e.tnn_init_date?new Date(e.tnn_init_date):o,f=e.tnn_last_visit?new Date(e.tnn_last_visit):g,u=e.tnn_conv?e.tnn_conv:"001";if(f.toString()!==o.toString()){var d=(o-f)/36e5,h=(o-f)/864e5;e.tnn_last_visit=new Date,d>.5&&(++e.tnn_sport_log[s].count,e.tnn_sport_log[s].log.push(o),h<=365&&parseInt(u)<2?e.tnn_conv="002":h>365&&"001"!=u&&(++(e=new ObjTnn(o,o,"001")).tnn_sport_log[s].count,e.tnn_sport_log[s].log.push(o)))}}}else null!==s&&(++(e=new ObjTnn(o,o,"001")).tnn_sport_log[s].count,e.tnn_sport_log[s].log.push(o));if(i){var w=(n=JSON.parse(i)).conv_init_date?new Date(n.conv_init_date):o,p=n.conv_last_visit?new Date(n.conv_last_visit):w,b=n.conv?n.conv:"001";if(p.toString()!==o.toString()){var S=(o-p)/36e5,O=(o-p)/864e5;n.conv_last_visit=new Date,S>.5&&(10==n.conv_visit_log.length&&n.conv_visit_log.shift(),n.conv_visit_log.push(n.conv_last_visit),O<=30&&parseInt(b)<2?n.conv="002":O>30&&"001"!=b&&(n=new ObjConv(o,o,"001")))}}else n=new ObjConv(o,o,"001");l?(t=JSON.parse(l)).br!==c&&(t=new ObjScreenSize(c,r)):t=new ObjScreenSize(c,r),update_conv_data(n,e,t),"complete"!=document.readyState?document.addEventListener("DOMContentLoaded",(function(t){setEventHandlers(n)})):setEventHandlers(n)}function get_local_storge_var(n){return window.localStorage.getItem(n)}function set_local_storage_var(n,t){window.localStorage.setItem(n,t)}function update_conv_data(n,t,e){n||gtmds_init(),set_local_storage_var("obj-conv",JSON.stringify(n));var o={conv:n.conv};null!==t&&(set_local_storage_var("obj-tnn",JSON.stringify(t)),o.tnn=t.tnn_conv),set_local_storage_var("obj-screen-size",JSON.stringify(e)),window.dataLayer=window.dataLayer||[],window.dataLayer.push(o)}function setEventHandlers(n){var t=document.querySelectorAll('a[href*="/sites/all/links/"]');if(0!==t.length)for(var e=t.length-1;e>=0;--e)t[e].addEventListener("click",(function(){if(!n){var t=get_local_storge_var("obj-conv");n=t?JSON.parse(t):new ObjConv(current_date,current_date,"001")}var e=this.toString(),o=e.substr(e.lastIndexOf("/")+1);if(affiliate_list.includes(o)){var i="affil-"+affiliate_list.indexOf(o),a=n.conv_affiliate_click[i],s=new Date;if(0===a.count)++a.count,a.log.push(s);else(s-new Date(a.log[a.log.length-1]))/6e4>=31&&(++a.count,a.log.push(s),a.log.length>10&&a.log.shift())}var l=n.conv,c=evalConvValue(this,n);n.conv=c!==l?c:l,update_conv_data(n)}))}function evalConvValue(n,t){var e=parseInt(t.conv);if(e<3)t.conv="003";else if(3===e&&n.toString().includes("bodog.php")){var o="affil-"+affiliate_list.indexOf("bodog.php"),i=t.conv_affiliate_click[o],a=(new Date(i.log[i.log.length-1])-new Date(t.conv_visit_log[t.conv_visit_log.length-1]))/1e3;t.conv_visit_log.length>=4&&i.count>=2&&a>0&&(t.conv="005")}return t.conv}function check_querystring(){var n=window.location.search,t=new URLSearchParams(n);return t.has("nationnetwork")&&""!==t.get("nationnetwork")?t.get("nationnetwork"):null}function ObjConv(n,t,e){this.conv_init_date=n,this.conv_last_visit=t,this.conv=e,this.conv_visit_log=[new Date],this.conv_affiliate_click={"affil-1":{count:0,log:[]}}}function ObjTnn(n,t,e){this.tnn_init_date=n,this.tnn_last_visit=t,this.tnn_conv=e,this.tnn_sport_log={"nba-lakers":{count:0,log:[]},nhl:{count:0,log:[]},"nhl-canucks":{count:0,log:[]},"nhl-oilers":{count:0,log:[]},"nhl-leafs":{count:0,log:[]},"nhl-flames":{count:0,log:[]},"mlb-dodgers":{count:0,log:[]},"mlb-jays":{count:0,log:[]}}}function ObjScreenSize(n,t){this.br=n,this.browser_platform=t}affiliate_list[0]="",affiliate_list[1]="bodog.php",gtmds_init();
//# sourceMappingURL=gtm-datalayer.js.map
